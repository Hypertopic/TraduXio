<div id="LRcontainer">
<div class="left-menu">
<div class="left-section"><?php echo __('Options'); ?></div>
<?php if($this->isMember){$explainNA=__("You're not allowed to do this. Ask permissions to the text's owner");}
      else{$explainNA=__("You're not allowed to do this. Please login");}
  $a_nohref = 'class="idle" title="'.$explainNA.'"';
  $HTmessage = __("You can't delete this translation because it has some translations. Delete its translations first.");?>
    

    <?php if($this->showEdit) {$href= 'href="'.$this->url(array('controller'=>'translation','action'=>'edit','id'=>$this->translation['id'])).'"';}
    else {$href = $a_nohref;}?>
    <div class="options"><a <?php echo $href; ?>><?php echo __('Edit this translation'); ?></a></div>      
    <br>
    
    <?php if($this->canManage): ?>
      <div class="options"><a href="<?php echo $this->url(array('controller'=>'work','action'=>'manage','id'=>$this->translation['id'])) ?>"><?php echo __("Manage text's privileges"); ?></a></div><br>
    <?php endif; ?>

 <?php if($this->canDelete): 
        if($this->hasTranslations==false): 
            $askConfirm = __("WARNING! Deletion is a definitive choice! Are you SURE you want to delete this text?");
            $href= 'href="'.$this->url(array('controller'=>'work','action'=>'delete','id'=>$this->translation['id'])).'" onClick="'."return confirm('".$askConfirm."')".'"' ;
        else: $href = 'class="idle" title="'.$HTmessage.'"'; endif;?>
        <div class = "options"><a <?php echo $href; ?> ><?php echo __("Delete this translation"); ?></a></div>
    <?endif; ?>
    

<br><br>
<div id="tag-area">
<?php if($this->canTag){echo $this->tagForm; } ?>
</div>
</div>


<table class="right-container" id="openbook-read">

<tr class="tag-line">
    <td class="orig-column">   
    <div class="show-tag-area">
        <?php if(!empty($this->translation['OriginalWork']['Tags'])): ?>
        <?php foreach($this->translation['OriginalWork']['Tags'] as $genre=>$names): ?>
        <div class="tag-group">
        <span class="genre"><?php echo __($this->translation['Genres'][$genre]); ?></span>
        <?php foreach($names as $name=>$tag): ?>
        <span class="tag-item" title="<?php echo __(strtolower($tag[0]['genre_name']));?>"><!-- style="font-size:<?php // echo 10+ round($tag['multiplicity']*7) ?>px"> --> <?php echo $name; ?></span>
        <?php endforeach; ?>
        </div>
        <?php endforeach; ?>
        <?php endif; ?>
    </div>
    </td>
    <td class="transl-column">
    <div class="show-tag-area">
        <?php if(!empty($this->translation['Tags'])): ?>
        <?php foreach($this->translation['Tags'] as $genre=>$names): ?>  
        <div class="tag-group">
        <span class="genre"><?php echo __($this->translation['Genres'][$genre]); ?></span>
        <?php foreach($names as $name=>$tag): ?>      
            <span class="tag-item" title="<?php echo __(strtolower($tag[0]['genre_name'])); ?>" style="font-size:<?php echo 8+ round($tag['multiplicity']*7) ?>px"><?php echo $name; ?>
            <?php $canRemove = false;?>
            <?php foreach($tag as $key=>$elem) {if(is_array($elem)&&(!is_null($this->userid))&&(in_array($this->userid,$elem))){ $canRemove = true;} } ?>
            <?php if($canRemove): ?>
                <a class="delete" href="<?php echo $this->url(array('controller'=>'tag','action'=>'deletetag','id'=>$this->translation['id'],'tag'=>$name,'genre'=>$genre))?>"> X </a>
            <?php endif; ?>
            </span>
        <?php endforeach; ?>        
        </div>
        <?php endforeach; ?>
        <?php endif; ?>
    </div>
    </td>
</tr>

<?php if(count($this->otherTranslations)>1): ?>
<tr class="onglets-line hundred">
<td class="orig-column hundred Lborder ">     
    <div class = "Tborder-ong">
        <div class = "TLcorner-ong"></div><div class = "TRcorner-ong"></div>
        </div>
        <div class="Lborder hundred">
            <div class="Rborder hundred">
                <div class = "work-container hundred"></div>
            </div>
        </div>
    
    
</td>

<td class="transl-column hundred">
<div class="clear">
  
  <ul id="other-onglet" class="onglets">
    <?php foreach($this->otherTranslations as $tr_id=>$otherTrl): //['Interpretations']
        if($this->translation['id']!=$tr_id): ?>
            <li class="onglet inactive">
            <span class="<?php if($otherTrl['work']['language']==$this->translation['language']){echo 'samelang';}else{echo 'difflang';}?>" title="<?php echo __($otherTrl['work']['language']) ?>">
                <a href="<?php echo $this->makeUrl('/translation/read/id/'.$otherTrl['work']['id']); ?>"><?php echo $otherTrl['work']['author']; ?></a>
            </span></li>
    <?php endif; endforeach; ?>
 </ul>
 </div>
 
</td>
</tr>
<?php endif; ?>

<tr class="hundred">
<td class="orig-column hundred Lborder"> 
<?php if(count($this->otherTranslations)==1): ?>   
    <div class = "Tborder-ong">
        <div class = "TLcorner-ong"></div><div class = "TRcorner-ong"></div>
    </div>
<?php endif; ?>
<div class="Lborder hundred">
    <div class="Rborder hundred">
    </div>
    <div class="Lborder hundred clear">
        <div class="Rborder hundred"> <div class = "work-container hundred"></div>
        </div>
    </div>
</div>
</td>

<td class="transl-column hundred">   
<div class="Tborder-ong clear" ><span id="current-onglet" class="onglet active"><?php echo $this->translation['author'] ?></span>
        <div class = "TLcorner-ong"></div><div class = "TRcorner-ong"></div>
 </div>
 <div class="Lborder hundred clear">
        <div class="Rborder hundred"><div class = "work-container hundred"></div>
        </div>
    </div>
</td>
</tr>

<tr class="hundred">
<td class="orig-column hundred Lborder"> 
<div class="Lborder hundred">
    <div class="Rborder hundred">
        <div class = "work-container hundred">
            <div class="title">
                <?php $author = $this->translation['OriginalWork']['author'];
                $title = $this->escape($this->translation['OriginalWork']['title']);
                if($author==''){$author=__('Anonymous');} 
                if($title==''){$title=__('No Title');} 
                ?>
                <span class="author red"><?php echo $author.', ' ?></span>
                <span class="title red">
                <?php if($this->translation['OriginalWork']['canRead']==true)
                {$href= 'class="red" href="'.$this->url(array('controller'=>'work','action'=>'read','id'=>$this->translation['OriginalWorkId'])).'"';}
                else {$href = $a_nohref;}?>
                <a <?php echo $href; ?>><?php echo $title; ?></a>
                </span>
            </div>
            <div class="language TBspaced red">
                <?php echo __($this->translation['OriginalWork']['language']); ?>
            </div>
        </div>
    </div>
</div>
</td>

<td class="transl-column hundred">   
 <div class="Lborder hundred clear">
    <!--<div class="TRcorner upshift"></div>-->
        <div class="Rborder hundred">
            <div class = "work-container hundred">
                <div class="title">          
                    <?php $author = $this->translation['author'];
                    $title = $this->escape($this->translation['title']);
                    if($author==''){$author=__('Anonymous');} 
                    if($title==''){$title=__('No Title');} ?>
                    <span class="author red"><?php echo $author.', ' ?></span>
                    <span class="title red"><?php echo $title ?></span>
                </div>
                <div class="language TBspaced red">
                    <?php echo __($this->translation['language']); ?>
                </div>
            </div>
        </div>
    </div>
</td>
</tr>





<?php foreach ($this->translation['TranslationBlocks'] as $blocknum=>$block) : ?>
<tr class="hundred">
<td class="orig-column hundred Lborder"> 
    <div class="Lborder hundred">
        <div class="Rborder hundred">
            <div class = "work-container upperblock hundred">
                <div class="block">
                    <?php Tdxio_Log::info($block,'translation read');
                    $first=true;
                    foreach ($block['OriginalSentences'] as $segnum=>$segment) : ?>
                        <?php $segment = $segment['content']; ?>
                        <?php $segment_id="text".$this->translation['OriginalWork']['id']."-segment".$segnum; ?>
                        <span class="segment" id="<?php echo $segment_id; ?>"><?php echo $this->nlBr($segment); ?></span>

                    <?php endforeach; ?>
                </div>
            </div>
        </div>
    </div>
</td>
<td class="transl-column hundred">
    <div class="Lborder hundred">
        <div class="Rborder hundred">
            <div class = "work-container upperblock hundred">
                <div class="block" id="<?php echo $div_id; ?>">
                    <?php Tdxio_Log::info($block,'translation read');
                    $first=true;?>
                    <span><?php echo $this->nlBr($block['translation']); ?></span>
                </div>
            </div>
        </div>
    </div>
</td>
</tr>
<!--
<tr>
<td> 
    <div class="Lborder">
        <div class="Rborder">
            <div class = "space-container">
            <br>
            </div>
        </div>
    </div>
</td>
<td>
    <div class="Lborder">
        <div class="Rborder">
            <div class = "space-container">
            <br>  
            </div>
        </div>
    </div>
</td>
</tr>
-->
<?php endforeach; ?>

<tr class="hundred">
<td class="orig-column hundred Lborder"> 
    <div class="Lborder hundred">
            <div class="Rborder hundred">
             <div class = "work-container hundred">
                <div class = "creator"> <?php echo (__('Text inserted by')).' ';  echo ($this->translation['OriginalWork']['creator']); ?> </div>
            </div>        
        </div></div>
        <div class = "Bborder">
            <div class = "BLcorner"></div><div class = "BRcorner"></div>
        </div>
<!--</div>-->
</td>

<td class="transl-column hundred">
    <div class="Lborder hundred">
            <div class="Rborder hundred">
  <div class = "work-container hundred">
                <div class = "creator"> <?php echo (__('Text inserted by')).' ';  echo ($this->translation['creator']); ?> </div>
            </div>
        </div></div>
        <div class = "Bborder">
            <div class = "BLcorner"></div><div class = "BRcorner"></div>
        </div>

</td>
</tr><tr><td colspan="2" class="bottom-spacer"></td></tr>
</table>
</div>

<?php $this->page_title=__("PAGETITLE_Read translation").': '.$this->escape($this->translation['title']); ?>
